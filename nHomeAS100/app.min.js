function findById(n,t){var i=n-1;users[i]?t(null,users[i]):t(new Error("User "+n+" does not exist"))}function findByUsername(n,t){for(var r,i=0,u=users.length;i<u;i++)if(r=users[i],r.username===n)return t(null,r);return t(null,null)}function ensureAuthenticated(n,t,i){if(n.isAuthenticated())return i();t.redirect("/login")}var express=require("express"),engine=require("ejs-locals"),routes=require("./routes"),http=require("http"),path=require("path"),flash=require("connect-flash"),passport=require("passport"),util=require("util"),LocalStrategy=require("passport-local").Strategy,users=[{id:1,username:"bob",password:"secret",email:"bob@example.com"},{id:2,username:"joe",password:"birthday",email:"joe@example.com"}],app;passport.serializeUser(function(n,t){t(null,n.id)}),passport.deserializeUser(function(n,t){findById(n,function(n,i){t(n,i)})}),passport.use(new LocalStrategy(function(n,t,i){process.nextTick(function(){findByUsername(n,function(r,u){return r?i(r):u?u.password!=t?i(null,!1,{message:"Invalid password"}):i(null,u):i(null,!1,{message:"Unknown user "+n})})})})),app=express(),app.set("port",process.env.PORT||3e3),app.engine("ejs",engine),app.set("views",__dirname+"/views"),app.set("view engine","ejs"),app.use(express.favicon()),app.use(express.logger("dev")),app.use(express.bodyParser()),app.use(express.methodOverride()),app.use(express.cookieParser("bnplbi1uaG9tZWFzMTAw")),app.use(express.session({secret:"bnplbi1uaG9tZWFzMTAw"})),app.use(flash()),app.use(passport.initialize()),app.use(passport.session()),app.use(app.router),app.use(express.static(path.join(__dirname,"public"))),app.set("title","nHomeAS100"),"development"==app.get("env")&&app.use(express.errorHandler()),app.get("/",routes.index),app.get("/account",ensureAuthenticated,function(n,t){t.render("account",{title:"Account",user:n.user,message:n.flash("error")})}),app.get("/login",function(n,t){t.render("login",{title:"Login",user:n.user,message:n.flash("error")})}),app.post("/login",passport.authenticate("local",{failureRedirect:"/login",failureFlash:!0}),function(n,t){t.redirect("/")}),app.get("/logout",function(n,t){n.logout(),t.redirect("/")}),http.createServer(app).listen(app.get("port"),function(){console.log("Express server listening on port "+app.get("port"))})